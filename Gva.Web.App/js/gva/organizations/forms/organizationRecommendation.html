<ng-form class="form-inline" sc-validate="{}" sc-form-readonly>
  <h5 class="form-header" style="margin-top:10px;" ng-init="commonData = false">
    <a l10n-text="organizations.recommendationDirective.commonData.title" ng-click="commonData = !commonData" style="cursor:pointer;"></a>
  </h5>

  <div ng-show="commonData">
    <div class="row">
      <sc-field type="nomenclature" ng-model="model.part.recommendationPart" alias="'auditParts'" l10n-text="organizations.recommendationDirective.commonData.recommendationPart" class="col-sm-4 col-md-3"></sc-field>
    </div>
    <h5 class="form-header" l10n-text="organizations.recommendationDirective.commonData.form"></h5>

    <div class="row">
      <sc-field type="date" ng-model="model.part.formDate" l10n-text="organizations.recommendationDirective.commonData.formDate" class="col-sm-3 col-md-2"></sc-field>
      <sc-field type="text" ng-model="model.part.formText" l10n-text="organizations.recommendationDirective.commonData.formText" class="col-sm-3 col-md-2"></sc-field>
    </div>
    <div class="row">
      <sc-field type="text" ng-model="model.part.interviewedStaff" l10n-text="organizations.recommendationDirective.commonData.interviewedStaff" class="col-sm-6 col-md-4"></sc-field>
    </div>
    <div class="row">
      <sc-field type="date" ng-model="model.part.fromDate" l10n-text="organizations.recommendationDirective.commonData.fromDate" class="col-sm-3 col-md-2"></sc-field>
      <sc-field type="date" ng-model="model.part.toDate" l10n-text="organizations.recommendationDirective.commonData.toDate" class="col-sm-3 col-md-2"></sc-field>
    </div>
    <h5 class="form-header" l10n-text="organizations.recommendationDirective.commonData.part1"></h5>

    <div class="row">
      <sc-field type="date" ng-model="model.part.finished1Date" l10n-text="organizations.recommendationDirective.commonData.finished1Date" class="col-sm-3 col-md-2"></sc-field>
      <sc-field type="text" ng-model="model.part.town1" l10n-text="organizations.recommendationDirective.commonData.town" class="col-sm-3 col-md-2"></sc-field>
    </div>
    <h5 class="form-header" l10n-text="organizations.recommendationDirective.commonData.part2"></h5>

    <div class="row">
      <sc-field type="date" ng-model="model.part.finished2Date" l10n-text="organizations.recommendationDirective.commonData.finished2Date" class="col-sm-3 col-md-2"></sc-field>
      <sc-field type="text" ng-model="model.part.town2" l10n-text="organizations.recommendationDirective.commonData.town" class="col-sm-3 col-md-2"></sc-field>
    </div>
    <h5 class="form-header" l10n-text="organizations.recommendationDirective.commonData.part3"></h5>

    <div class="row">
      <sc-field type="date" ng-model="model.part.finished3Date" l10n-text="organizations.recommendationDirective.commonData.finished3Date" class="col-sm-3 col-md-2"></sc-field>
      <sc-field type="text" ng-model="model.part.town3" l10n-text="organizations.recommendationDirective.commonData.town" class="col-sm-3 col-md-2"></sc-field>
    </div>
    <div class="row">
      <sc-field type="text" ng-model="model.part.documentDescription" l10n-text="organizations.recommendationDirective.commonData.documentDescription" class="col-sm-6 col-md-4"></sc-field>
    </div>
    <h5 class="form-header" l10n-text="organizations.recommendationDirective.commonData.part4"></h5>

    <div class="row">
      <sc-field type="date" ng-model="model.part.finished4Date" l10n-text="organizations.recommendationDirective.commonData.finished4Date" class="col-sm-3 col-md-2"></sc-field>
      <sc-field type="text" ng-model="model.part.town4" l10n-text="organizations.recommendationDirective.commonData.town" class="col-sm-3 col-md-2"></sc-field>
    </div>
    <h5 class="form-header" l10n-text="organizations.recommendationDirective.commonData.part5"></h5>

    <div class="row">
      <sc-field type="date" ng-model="model.part.finished5Date" l10n-text="organizations.recommendationDirective.commonData.finished5Date" class="col-sm-3 col-md-2"></sc-field>
      <sc-field type="text" ng-model="model.part.town5" l10n-text="organizations.recommendationDirective.commonData.town" class="col-sm-3 col-md-2"></sc-field>
    </div>
    <div class="row" style="margin-bottom:10px">
      <sc-field type="text" rows="3" ng-model="model.part.recommendation" l10n-text="organizations.recommendationDirective.commonData.recommendation" class="col-sm-6 col-md-4"></sc-field>
    </div>
    <div class="row" style="margin-bottom:10px">
      <div class="form-group col-sm-6 col-md-4">
        <label class="control-label" l10n-text="organizations.recommendationDirective.commonData.applications"></label>
        <gva-applications ng-model="model.applications" set-part="'organization'" ng-readonly="form.$readonly"></gva-applications>
      </div>
    </div>
    <h5 class="form-header" l10n-text="organizations.recommendationDirective.commonData.auditorsTitle"></h5>

    <gva-common-auditor ng-model="model.part.part1.examiners" name="examinersForm1"></gva-common-auditor>
  </div>
  <h5 class="form-header" style="margin-top:10px;" ng-init="showAuditorsReview = false">
    <a l10n-text="organizations.recommendationDirective.auditorsReview.title" ng-click="showAuditorsReview = !showAuditorsReview" style="cursor:pointer;"></a>
  </h5>

  <div ng-show="showAuditorsReview">
    <sc-button name="chooseAuditsBtn" type="button" btn-click="chooseAudits()" class="btn btn-primary btn-sm" icon="glyphicon-plus" text="organizations.recommendationDirective.auditorsReview.chooseAudits" ng-disabled="form.$readonly"></sc-button>
    <sc-datatable items="auditorsReview.auditDetails" filterable="false" pageable="true" sortable="true" dynamic-columns="false">
      <sc-column data="auditPart.name" title="organizations.recommendationDirective.auditorsReview.auditPart"></sc-column>
      <sc-column data="subject" title="organizations.recommendationDirective.auditorsReview.subject"></sc-column>
      <sc-column data="auditResult.name" title="organizations.recommendationDirective.auditorsReview.auditResult"></sc-column>
      <sc-column title="organizations.recommendationDirective.auditorsReview.disparity" has-content="true"> <span>{{item.disparities.join(',')}}</span>
      </sc-column>
    </sc-datatable>

    <h5 class="form-header" l10n-text="organizations.recommendationDirective.auditorsReview.auditorsTitle" style="clear:both;"></h5>
    <gva-common-auditor ng-model="model.part.part2.examiners" name="examinersForm2"></gva-common-auditor>
  </div>

  <h5 class="form-header" style="margin-top:10px;" ng-init="accordance = false">
    <a l10n-text="organizations.recommendationDirective.accordance.title" ng-click="accordance = !accordance" style="cursor:pointer;"></a>
  </h5>

  <div ng-show="accordance">
    <h5 class="form-header" l10n-text="organizations.recommendationDirective.accordance.AuditDetailTitle"></h5>
    <sc-button btn-click="insertAuditDetails()" ng-disabled="!model.part.recommendationPart || form.$readonly" ng-if="!model.part.descriptionReview.auditDetails.length" text="organizations.recommendationDirective.accordance.insertAuditDetails" class="btn btn-default"></sc-button>
    <table class="table table-striped table-bordered" ng-if="model.part.descriptionReview.auditDetails.length > 0">
      <thead>
        <tr>
          <th l10n-text="organizations.recommendationDirective.accordance.auditPart"></th>
          <th l10n-text="organizations.recommendationDirective.accordance.subject"></th>
          <th>
            <div sc-has-error="auditResult" class="col-sm-2 col-md-2">
              <label class="control-label" l10n-text="organizations.recommendationDirective.accordance.auditResult"></label>
              <sc-validation-error field-name="auditResult" validations="{required: 'default'}"></sc-validation-error>
            </div>
          </th>
          <th l10n-text="organizations.recommendationDirective.accordance.disparity"></th>
        </tr>
      </thead>
      <tbody ng-repeat="auditDetailGroup in model.part.descriptionReview.auditDetails">
        <tr>
          <td colspan="5" class="text-center" style="background: #A8A8A8; color: white">{{auditDetailGroup.groupTitle}}</td>
        </tr>
        <tr ng-repeat="detail in auditDetailGroup.group">
          <td>{{detail.auditPart}}</td>
          <td class="col-sm-4 col-md-3">{{detail.subject}}</td>
          <td class="col-sm-4 col-md-3">
            <sc-nomenclature ng-model="detail.auditResult" name="auditResult" alias="'auditResults'" ng-required="true" ng-readonly="form.$readonly"></sc-nomenclature>
          </td>
          <td class="row">
            <sc-button name="addDisparityBtn" type="button" btn-click="addDisparity(detail)" class="btn btn-primary btn-sm pull-right" icon="glyphicon-plus" ng-show="detail.auditResult.code === '1' || detail.auditResult.code === '2'" ng-disabled="form.$readonly"></sc-button>
            <div class="nav-pills pull-left" ng-repeat="detail in detail.disparities">
              <a href="" scroll-to=".disparity{{detail}}">
                <span class="badge pull-right">{{detail}}</span>
              </a>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="sort-disabled" ng-if="!model.part.descriptionReview.auditDetails.length && insertionBtnIsClicked">
      <span colspan="8" l10n-text="organizations.recommendationDirective.disparities.noAvailableDisparities"></span>
    </div>

    <h5 class="form-header" l10n-text="organizations.recommendationDirective.accordance.auditorsTitle"></h5>
    <gva-common-auditor ng-model="model.part.part3.examiners" name="examinersForm3"></gva-common-auditor>
  </div>

  <h5 class="form-header" style="margin-top:10px;" ng-init="disparities = false">
    <a l10n-text="organizations.recommendationDirective.disparities.title" ng-click="disparities = !disparities" style="cursor:pointer;"></a>
  </h5>

  <div ng-show="disparities">
    <h5 class="form-header" l10n-text="organizations.recommendationDirective.disparities.disparitiesRecommendationsTitle1"></h5>
    <table class="table table-striped table-bordered">
      <thead>
        <tr>
          <th l10n-text="organizations.recommendationDirective.disparities.sortOrder"></th>
          <th l10n-text="organizations.recommendationDirective.disparities.subject"></th>
          <th l10n-text="organizations.recommendationDirective.disparities.refNumber"></th>
          <th l10n-text="organizations.recommendationDirective.disparities.description"></th>
          <th l10n-text="organizations.recommendationDirective.disparities.disparityLevel"></th>
          <th l10n-text="organizations.recommendationDirective.disparities.removalDate"></th>
          <th l10n-text="organizations.recommendationDirective.disparities.closureDate"></th>
          <th l10n-text="organizations.recommendationDirective.disparities.rectifyAction"></th>
          <th l10n-text="organizations.recommendationDirective.disparities.closureDocument"></th>
        </tr>
      </thead>
      <tbody>
        <tr ng-repeat="disparity in auditorsReview.disparities">
          <td class="col-sm-1 col-md-1">{{disparity.sortOrder}}</td>
          <td class="col-sm-3 col-md-2">{{disparity.subject}}</td>
          <td>{{disparity.refNumber}}</td>
          <td>{{disparity.description}}</td>
          <td>{{disparity.disparityLevel.name}}</td>
          <td>{{disparity.removalDate | date:'mediumDate'}}</td>
          <td>{{disparity.closureDate | date:'mediumDate'}}</td>
          <td>{{disparity.rectifyAction}}</td>
          <td>{{disparity.closureDocument}}</td>
          <td class="row">
            <sc-button name="editBtn" btn-click="editDisparity(disparity)" class="btn btn-xs btn-primary" icon="glyphicon-pencil" ng-disabled="form.$readonly"></sc-button>
          </td>
        </tr>
        <tr class="sort-disabled" ng-if="!auditorsReview.disparities.length">
          <td colspan="8" l10n-text="organizations.recommendationDirective.disparities.noAvailableDisparities"></td>
        </tr>
      </tbody>
    </table>
    <h5 class="form-header" l10n-text="organizations.recommendationDirective.disparities.disparitiesRecommendationsTitle2"></h5>

    <gva-common-disparity name="recomendationDisparitiesFromDescriptionForm" ng-model="model.part.descriptionReview"></gva-common-disparity>
    <h5 class="form-header" l10n-text="organizations.recommendationDirective.disparities.auditorsTitle"></h5>

    <gva-common-auditor ng-model="model.part.part4.examiners" name="examinersForm4"></gva-common-auditor>
  </div>
  <h5 class="form-header" style="margin-top:10px;" ng-init="recommendations = false">
    <a l10n-text="organizations.recommendationDirective.recommendations.title" ng-click="recommendations = !recommendations" style="cursor:pointer;"></a>
  </h5>

  <div ng-show="recommendations">
    <h5 class="form-header" l10n-text="organizations.recommendationDirective.recommendations.auditorsTitle"></h5>
    <gva-common-auditor ng-model="model.part.part5.examiners" name="examinersForm5"></gva-common-auditor>
  </div>
</ng-form>