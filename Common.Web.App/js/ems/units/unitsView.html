<style>
  .units-view .selected-unit {
    background-color: rgba(48, 47, 200, 0.2);
  }

  .units-view .child-unit {
    margin-left: 25px;
  }

  .units-view .deactivate-icon {
    color: red;
  }

  .units-view .delete-icon {
    color: red;
  }

  .units-view .activate-icon {
    color: lawngreen;
  }

  .units-view .inactive-unit {
    color: darkgray;
  }

  .units-view span {
    cursor: default;
  }

  .ab-stackicon-container {
    display: inline-block;
    position: relative;
    width: 14px;
    height: 14px;
  }

  .ab-stackicon-bigicon {
    position: absolute;
    top: auto;
    right: 0;
    bottom: 0;
    left: auto;
    font-size: 14px;
  }

  .ab-stackicon-smallicon {
    color: deepskyblue;
    position: absolute;
    top: auto;
    right: 0;
    bottom: 0;
    left: auto;
    font-size: 8px;
  }

  .ab-icon-button {
    border: 0;
    padding: 0;
    cursor: pointer;
    color: black;
  }

    .ab-icon-button > span {
      cursor: pointer;
    }

    .ab-icon-button:hover {
      text-decoration: none;
      color: black;
    }
</style>

<script type="text/ng-template" id="unit_recursive_template.html">

  <div ng-if="unit.type == 'Department'"
       ng-init="unit.isVisible = true"
       ng-show="unit.isVisible">
    <div ng-init="unit.isSelected = false"
         ng-class="{'selected-unit': unit.isSelected}"
         ng-click="selectUnit(unit)">

      <div class="ab-stackicon-container"
           ng-init="unit.isCollapsed=false"
           ng-click="unit.isCollapsed = !unit.isCollapsed">
        <span class="glyphicon glyphicon-folder-open ab-stackicon-bigicon"></span>
        <span class="glyphicon ab-stackicon-smallicon"
              ng-class="{'glyphicon-chevron-right': unit.isCollapsed,'glyphicon-chevron-down': !unit.isCollapsed}"></span>
      </div>
      <span ng-class="{'inactive-unit': !unit.isActive}">
        {{unit.name}}
      </span>

      <span class="glyphicon glyphicon-pencil"
            ng-show="unit.isSelected && unit.isActive"
            ng-click="editUnit(unit.unitId); $event.stopPropagation();"></span>

      <span class="glyphicon glyphicon-off deactivate-icon"
            ng-show="unit.isSelected && unit.isActive"
            ng-click="setUnitActiveStatus(unit, false); $event.stopPropagation();"></span>
      <span class="glyphicon glyphicon-off activate-icon"
            ng-show="unit.isSelected && !unit.isActive"
            ng-click="setUnitActiveStatus(unit, true); $event.stopPropagation();"></span>
      <span class="glyphicon glyphicon-remove delete-icon"
            ng-show="unit.isSelected && canUnitBeDeleted(unit)"
            ng-click="deleteUnit(unit); $event.stopPropagation();"></span>
      <span class="glyphicon glyphicon-plus-sign"
            ng-show="unit.isSelected"
            ng-click="addNewUnit(unit.unitId, 'Department'); $event.stopPropagation();"></span>
    </div>

    <div class="child-unit"
         ng-if="unit.childUnits"
         ng-show="!unit.isCollapsed">
      <div ng-repeat="unit in unit.childUnits"
           ng-include="'unit_recursive_template.html'">
      </div>
    </div>
  </div>

  <div ng-if="unit.type != 'Department'"
       ng-init="unit.isVisible = true"
       ng-show="unit.isVisible"
       ng-init="unit.isSelected = false"
       ng-class="{'selected-unit': unit.isSelected}"
       ng-click="selectUnit(unit)">
    <span class="glyphicon glyphicon-user"></span>
    <span ng-class="{'inactive-unit': !unit.isActive}">
      {{unit.name}}
    </span>
    <span ng-show="unit.isSelected">
      <span class="glyphicon glyphicon-plus-sign"
            ng-show="unit.childUnits.length === 0"
            ng-click="addNewUnit(unit.unitId, 'Employee'); $event.stopPropagation();"></span>
      <span class="glyphicon glyphicon-pencil"
            ng-show="unit.isActive"
            ng-click="editUnit(unit.unitId); $event.stopPropagation();"></span>

      <span class="glyphicon glyphicon-off deactivate-icon"
            ng-show="unit.isActive"
            ng-click=" setUnitActiveStatus(unit, false); $event.stopPropagation();"></span>
      <span class="glyphicon glyphicon-off activate-icon"
            ng-show="!unit.isActive"
            ng-click="setUnitActiveStatus(unit, true); $event.stopPropagation();"></span>
      <span class="glyphicon glyphicon-remove delete-icon"
            ng-show="unit.isSelected && canUnitBeDeleted(unit)"
            ng-click="deleteUnit(unit); $event.stopPropagation();"></span>
      <!--this wan't work in case of inactive-->
      <span class="glyphicon glyphicon-plus-sign"
            ng-show="unit.isSelected && unit.childUnits.length === 0"
            ng-click="addNewUnit(unit.unitId, 'Position'); $event.stopPropagation();"></span>

    </span>

    <span ng-if="unit.childUnits">
      <span class="glyphicon glyphicon-minus"></span>
      <span ng-class="{'inactive-unit': !unit.childUnits[0].isActive}">
        {{unit.childUnits[0].name}}
      </span>

      <!--<span class="glyphicon glyphicon-pencil"
            ng-show="unit.isActive"
            ng-click="editUnit(unit.unitId); $event.stopPropagation();"></span>-->

      <span class="glyphicon glyphicon-off deactivate-icon"
            ng-show="unit.isSelected && unit.childUnits[0].isActive"
            ng-click="setUnitActiveStatus(unit.childUnits[0], false); $event.stopPropagation();"></span>
      <span class="glyphicon glyphicon-off activate-icon"
            ng-show="unit.isSelected && !unit.childUnits[0].isActive"
            ng-click="setUnitActiveStatus(unit.childUnits[0], true); $event.stopPropagation();"></span>
      <span class="glyphicon glyphicon-remove delete-icon"
            ng-show="unit.isSelected && canUnitBeDeleted(unit.childUnits[0])"
            ng-click="deleteUnit(unit.childUnits[0]); $event.stopPropagation();"></span>
      <!--User section-->
      <span ng-show="unit.childUnits[0].isActive">
        <span class="glyphicon glyphicon-minus"></span>
        {{unit.childUnits[0].user.userName}}
        <span class="glyphicon glyphicon-forward"
              tooltip="Прикачи потребител"
              ng-show="unit.isSelected && !unit.childUnits[0].user"
              ng-click="attachUserToUnit(unit.childUnits[0].unitId); $event.stopPropagation();"></span>
        <span class="glyphicon glyphicon-remove-circle"
              tooltip="Премахване на връзката с потребител"
              ng-show="unit.isSelected && unit.childUnits[0].user"
              ng-click="detachUserFromUnit(unit.childUnits[0].unitId, unit.childUnits[0].user.userId); $event.stopPropagation();"></span>
      </span>

    </span>
  </div>

</script>

<!--This code is for testing the hierarchy vis
ualisation, without custom functionlaity overhead.
<script type="text/ng-template" id="simple_test_recursive_template.html">
  {{unit.name}}
  <div style="margin-left: 10px;"
       ng-init="unit.isVisible = true;"
       ng-show="unit.isVisible"
       ng-repeat="unit in unit.childUnits"
       ng-include="'simple_test_recursive_template.html'">
  </div>
</script>-->

<div class="units-view">

  <label>
    <span l10n-text="common.units.filter"></span>
    <input type="text"
           ng-model="filterValue" />
  </label>

  <button class="btn btn-sm btn-default"
          type="button">
    <span class="glyphicon glyphicon-remove clear-icon"
          ng-click="clearFilter()"></span>
  </button>

  <sc-button name="refreshButton"
             btn-click="refresh()"
             class="btn btn-default btn-xs"
             text="common.units.refresh"
             icon="glyphicon-repeat"></sc-button>
  <label>
    <span l10n-text="common.units.includeInactive"></span>
    <input type="checkbox" ng-model="includeInactive">
  </label>

  <div>
    <span class="glyphicon glyphicon-chevron-down"
          ng-click="setCollapsedStateOfAll(false)">
    </span>
    <span class="glyphicon glyphicon-chevron-up"
          ng-click="setCollapsedStateOfAll(true)">
    </span>
  </div>

  <div ng-repeat="unit in model" ng-include="'unit_recursive_template.html'"></div>
  <span class="glyphicon glyphicon-plus-sign" ng-click="addNewUnit(null, 'Department'); $event.stopPropagation();"></span>

</div>
